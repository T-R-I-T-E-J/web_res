# PostgreSQL Client Authentication Configuration (pg_hba.conf)
# SECURITY HARDENED - Controls who can connect to the database

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# ============================================
# LOCAL CONNECTIONS (Unix socket)
# ============================================
# Require password even for local connections
local   all             all                                     scram-sha-256

# ============================================
# IPv4 CONNECTIONS
# ============================================

# SECURITY: Only allow connections from Docker network
# Reject all other connections

# Allow from Docker network (172.25.0.0/16)
host    all             all             172.25.0.0/16           scram-sha-256

# Allow from localhost (for local development)
host    all             all             127.0.0.1/32            scram-sha-256

# SECURITY: Explicitly reject all other IPv4 connections
host    all             all             0.0.0.0/0               reject

# ============================================
# IPv6 CONNECTIONS
# ============================================

# Allow from localhost IPv6
host    all             all             ::1/128                 scram-sha-256

# SECURITY: Reject all other IPv6 connections
host    all             all             ::/0                    reject

# ============================================
# SSL CONNECTIONS (Production)
# ============================================
# Uncomment these for production with SSL certificates

# Require SSL for all remote connections
# hostssl all             all             172.20.0.0/16           scram-sha-256
# hostssl all             all             0.0.0.0/0               reject

# ============================================
# NOTES
# ============================================
# 1. scram-sha-256 is the most secure password authentication method
# 2. Never use 'trust' method in production
# 3. Never use 'md5' - it's deprecated and insecure
# 4. Always use 'reject' for unknown networks
# 5. Enable SSL (hostssl) in production
# 6. Regularly review and update this file
# 7. Restart PostgreSQL after changes: docker-compose restart postgres

# ============================================
# SECURITY BEST PRACTICES
# ============================================
# ✅ Use scram-sha-256 (strongest password encryption)
# ✅ Limit connections to specific networks
# ✅ Reject all unknown connections
# ✅ Enable SSL for remote connections
# ✅ Never expose database to public internet
# ✅ Use firewall rules in addition to pg_hba.conf
# ✅ Monitor failed connection attempts in logs
# ✅ Rotate database passwords regularly
